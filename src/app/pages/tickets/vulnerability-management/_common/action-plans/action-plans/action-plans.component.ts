import { Component, Inject, Input, OnInit } from '@angular/core';
import { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { MatTableDataSource } from '@angular/material/table';
import { DbTicket } from 'src/app/core/model/db-ticket.model';
import { ActionPlansModalComponent } from '../action-plans-modal/action-plans-modal.component';
import { MaterialModalConfig } from 'src/app/shared/modals/config/material.modal.config.impl';
import { ModalConfiguration } from 'src/app/shared/modals/config/modal.config';
import { SUB_SERVICES, TicketStatusJSON, TicketType } from 'src/app/shared/constants';

@Component({
  selector: 'app-action-plans',
  templateUrl: './action-plans.component.html',
  styleUrls: ['./action-plans.component.scss']
})
export class ActionPlansComponent implements OnInit {
  @Input() ticket: DbTicket;
  @Input() isNewTicket: boolean = false;

  dataSource: any;

  public ticketStatus = TicketStatusJSON;
  public ticketType = TicketType;

  constructor(
    public dialog: MatDialog,
  ) {
    this.dataSource = new MatTableDataSource([]);
  }

  ngOnInit(): void {}

  checkObservable(actionPlans) {
    this.dataSource.data = actionPlans;
  }

  public actionPlansColumns: string[] = [
    "actionPlans",
    "service",
    "assigned",
    "closedDate",
    "state",
    "progress",
  ];

  openModalActionPlan() {
    let modalConfig: ModalConfiguration = new MaterialModalConfig();

    const materialDialogConf = modalConfig.buildModalConfig('450px', this.ticket.id);
    const dialogRef = this.dialog.open(ActionPlansModalComponent, materialDialogConf);

    dialogRef.afterClosed().subscribe(res => {
      console.log('The dialog was closed');
    });
  }
}
